/*!
 * JDataPaging v1.1.0 Â©
 * @author salvatore mariniello - salvo.mariniello@gmail.com 
 * https://github.com/mssalvo/JDataPaging 
 * MIT License
 * Copyright (c) 2019 Salvatore Mariniello
 * https://github.com/mssalvo/JDataPaging/blob/master/LICENSE
 **/
function JDataPaging(b){var a=this;a.log("INIT JDataPaging!");if(b){a._new().settyng(b)}else{a.log("JDataPaging Info: >> No object declared : Example [ JDataPaging.paging('myname',{data:object,box:' '}) ] info: https://github.com/mssalvo/JDataPaging")}}JDataPaging.rows=[];JDataPaging.selectorBox={};JDataPaging.selectorRowName="";JDataPaging.limit=4;JDataPaging.pagination={};JDataPaging.pageCurrent=0;JDataPaging.pageMax=1;JDataPaging.labelPageCurrent=undefined;JDataPaging.labelPageTotal=undefined;JDataPaging.btnNext=undefined;JDataPaging.btnPrevious=undefined;JDataPaging.comboPages=undefined;JDataPaging.pages=["10","20","30","40","50"];JDataPaging.prototype.dataSupport=undefined;JDataPaging.get={};if(typeof window.console==="undefined"||typeof window.console.log==="undefined"){window.console={log:function(){}}}JDataPaging.prototype.log=window.console.log;JDataPaging.prototype.isArray=function(a){return a.constructor.toString().indexOf("Array")>-1};JDataPaging.prototype.creaView=function(){var a=this;if(a.plugin){a.clear();a.dataSupport.home=a;a.dataSupport.createView(a.jmsTemplate,a.data,a.selectorBox)}else{a.log("[JDataPaging] Info error:: dataSupport not istance > check include data-support.js")}return a};JDataPaging.prototype.settyng=function(a){this.pages=["10","20","30","50"];this.btnNext=undefined;this.btnPrevious=undefined;this.ajaxSetting={url:"",type:"get",dataType:"json"};if(a.box){this.selectorBox=document.querySelector(a.box)}if(a.row){this.selectorRowName=a.row}this.rows=[];this.rowsWrap=[];this.pageCurrent=0;if(a.pages){this.pages=a.pages}if(a.btnNext){this.btnNext=document.querySelectorAll(a.btnNext)}if(a.btnPrevious){this.btnPrevious=document.querySelectorAll(a.btnPrevious)}if(a.comboPages){this.comboPages=document.querySelectorAll(a.comboPages)}if(a.labelPageCurrent){this.labelPageCurrent=document.querySelectorAll(a.labelPageCurrent)}if(a.labelPageTotal){this.labelPageTotal=document.querySelectorAll(a.labelPageTotal)}if(a.inputSearch){this.inputSearch=document.querySelectorAll(a.inputSearch)}this.limit=Number(this.pages[0]);if(a.onComplete){this.onComplete=a.onComplete}if(a.onNextBefore){this.onNextBefore=a.onNextBefore}if(a.onNextAfter){this.onNextAfter=a.onNextAfter}if(a.onPreviusBefore){this.onPreviusBefore=a.onPreviusBefore}if(a.onPreviousAfter){this.onPreviousAfter=a.onPreviousAfter}if(a.onChangeComboPages){this.onChangeComboPages=a.onChangeComboPages}if(a.onBeforeRow){this.onBeforeRow=a.onBeforeRow}if(a.onAfterRow){this.onAfterRow=a.onAfterRow}if(a.plugin){this.plugin=a.plugin}if(typeof(a.autoStart)!=="undefined"){this.autoStart=a.autoStart}if(a.jmsTemplate){this.jmsTemplate=a.jmsTemplate}if(a.data){this.data=this.isArray(a.data)?{data:a.data}:a.data}if(a.plugin){this.dataSupport=this.plugin.istance();this.dataSupport.home=this}if(a.plugin&&a.url){this.ajaxSetting.url=a.url}if(a.plugin&&a.param&&typeof(a.param)==="function"){a.param.apply(this,[this.parameter])}if(a.plugin&&a.ajaxSetting&&typeof(a.ajaxSetting)==="function"){a.ajaxSetting.apply(this,[this.ajaxSetting])}if(typeof(a.isServer)!=="undefined"){this.isServer=a.isServer}if(typeof(this.ajaxSetting.type)==="undefined"){this.ajaxSetting.type="get"}if(typeof(this.ajaxSetting.dataType)==="undefined"){this.ajaxSetting.dataType="json"}if(typeof(a.url)!=="undefined"){this.isAjax=true}if(this.autoStart&&typeof(a.url)!=="undefined"){this.isAjax=true;this.dataSupport.ajaxCallServer("start")}if(this.autoStart&&typeof(a.url)==="undefined"){return this.start()}if(!this.autoStart&&typeof(a.url)!=="undefined"){this.dataSupport.ajaxCallServer("dataSet")}return this};JDataPaging.prototype.dataSet=function(b){var a=this;if(b){a.data=a.isArray(b)?{data:b}:b}return a};JDataPaging.prototype.play=function(){var a=this;if(a.isAjax){a.dataSupport.ajaxCallServer("start")}else{return a.start()}return a};JDataPaging.prototype.start=function(b){var a=this;a.pageCurrent=0;a.log("START JDataPaging!");if(b){a.data=a.isArray(b)?{data:b}:b}if(a.jmsTemplate){return a.creaView().init().initComboPages().initInputSearch().initButtons().next().writeLabels()}else{return a.init().initComboPages().initInputSearch().initButtons().next().writeLabels()}};JDataPaging.prototype.getCurrentPage=function(){return this.pageCurrent};JDataPaging.prototype.getTotalPage=function(){return this.pageMax};JDataPaging.prototype._new=function(){this.isServer=false;this.isAjax=false;this.ajaxSetting={url:"",type:"get",dataType:"json"};this.jmsTemplate=undefined;this.plugin={};this.data={};this.autoStart=true;this.rows=[];this.rowsWrap=[];this.selectorBox=undefined;this.selectorRowName="";this.limit=10;this.rowsTotal=0;this.pagination=undefined;this.pageCurrent=0;this.pageMax=1;this.inputSearch=undefined;this.textSearch=undefined;this.labelPageCurrent=undefined;this.labelPageTotal=undefined;this.btnNext=undefined;this.btnPrevious=undefined;this.comboPages=undefined;this.onComplete=undefined;this.onNextBefore=undefined;this.onNextAfter=undefined;this.onPreviusBefore=undefined;this.onPreviousAfter=undefined;this.onChangeComboPages=undefined;this.onBeforeRow=function(e,d,f){return true};this.onAfterRow=function(e,d,f){return true};this.pages=["10","20","30","50"];this.back=false;return this};JDataPaging.prototype.jmsEvent=function(b,c){var a=this;if(typeof(a.dataSupport)!=="undefined"){if(typeof b!=="undefined"&&b!=="pp"){a.dataSupport.fn[b]=c}else{a.log("INFO!! it is not possible to associate a function with the name (pp) - change function name! - the function [pp] could not be subscribed!! ")}}else{a.log("the function could not be subscribed, dataSupport and undefined! Add the JDataPagingSupport plugin. Example: JDataPaging.paging('myIstName', {plugin:JDataPagingSupport, .....})")}return a};JDataPaging.prototype.jmsPipe=function(b,c){var a=this;if(typeof(a.dataSupport)!=="undefined"){a.dataSupport.fn.pp[b]=c}else{a.log("the function could not be subscribed, dataSupport and undefined! Add the JDataPagingSupport plugin. Example: JDataPaging.paging('myIstName', {plugin:JDataPagingSupport, .....})")}return a};JDataPaging.prototype.onCompleteCall=function(a){if(this.onComplete&&typeof(this.onComplete)==="function"){this.onComplete.apply(this,a)}return this};JDataPaging.prototype.onNextBeforeCall=function(a){if(this.onNextBefore&&typeof(this.onNextBefore)==="function"){this.onNextBefore.apply(this,a)}return this};JDataPaging.prototype.onNextAfterCall=function(a){if(this.onNextAfter&&typeof(this.onNextAfter)==="function"){this.onNextAfter.apply(this,a)}return this};JDataPaging.prototype.onPreviusBeforeCall=function(a){if(this.onPreviusBefore&&typeof(this.onPreviusBefore)==="function"){this.onPreviusBefore.apply(this,a)}return this};JDataPaging.prototype.onPreviousAfterCall=function(a){if(this.onPreviousAfter&&typeof(this.onPreviousAfter)==="function"){this.onPreviousAfter.apply(this,a)}return this};JDataPaging.prototype.onChangeComboPagesCall=function(a){if(this.onChangeComboPages&&typeof(this.onChangeComboPages)==="function"){this.onChangeComboPages.apply(this,a)}return this};JDataPaging.prototype.parameter={};JDataPaging.sendCallServer=function(c,a){var b=JDataPaging.calculatesSendStartEnd(c);c.parameter.start=b.start;c.parameter.end=b.end;c.parameter.limit=c.limit;c.parameter.page=c.pageCurrent;c.parameter.totalrows=c.rowsTotal;if(c.textSearch){c.parameter.search=c.textSearch}if(typeof c.textSearch==="undefined"&&typeof c.parameter.search!=="undefined"){delete c.parameter.search}if(c.textSearch===""&&typeof c.parameter.search!=="undefined"){delete c.parameter.search}c.parameter._tm=new Date().getTime();c.dataSupport.ajax_.parameters=c.parameter;c.dataSupport.ajax_.url=c.ajaxSetting.url;c.dataSupport.ajax_.type=c.ajaxSetting.type;c.dataSupport.ajax_.dataType=c.ajaxSetting.dataType;c.dataSupport.ajaxCallServer(a);return c};JDataPaging.prototype.startServer=function(c,b){var e=this;if(c){e.data=e.isArray(c)?{data:c,totalrows:c.length}:c}if(c.totalrows){e.rowsTotal=c.totalrows}e.pageMax=Math.ceil((e.rowsTotal/e.limit));if(e.jmsTemplate){e.creaView().initPageServer()}var d=e.rows.slice(0,e.limit);for(var a in d){e.selectorBox.appendChild(d[a])}if(b&&b==="next"){e.writeLabels().onNextAfterCall([d,e]).onCompleteCall([d])}else{if(b&&b==="previous"){e.writeLabels().onPreviousAfterCall([d,e]).onCompleteCall([d])}else{if(b&&b==="changeCombo"){e.writeLabels().onChangeComboPagesCall([{limit:e.limit,rowsTotal:e.rowsTotal,pageMax:e.pageMax},e]).onCompleteCall([d])}else{e.writeLabels().onCompleteCall([d])}}}return e};JDataPaging.nextServer=function(a){a.onNextBeforeCall([a]);if(a.pageCurrent<1||a.pageCurrent>0&&a.rowsTotal>0&&(a.pageCurrent*a.limit)<a.rowsTotal){++a.pageCurrent;a.clear();JDataPaging.sendCallServer(a,"next")}else{a.pageCurrent=a.pageMax}return a};JDataPaging.calculatesSendStartEnd=function(c){var a=0;if(c.pageCurrent===1){a=0}if(c.pageCurrent<1){c.pageCurrent=1;a=0}if(c.pageCurrent>1){a=((c.pageCurrent-1)*c.limit)}var b=(c.limit*c.pageCurrent);if(b>c.rowsTotal&&c.rowsTotal>0){b=c.rowsTotal}return{start:a,end:b}};JDataPaging.calculatesNext=function(c){var a=0;if(c.pageCurrent>1){a=((c.limit*c.pageCurrent)-c.limit)<=c.rows.length?((c.limit*c.pageCurrent)-c.limit):((c.limit*(c.pageCurrent-1))-c.limit)}var b=(c.limit*c.pageCurrent);if((a+c.limit)>=c.rows.length){--c.pageCurrent;c.back=true}if(a>=c.rows.length){a=(c.rows.length-c.limit);a=a<1?0:a}if(a===0){b=c.limit}return{start:a,end:b}};JDataPaging.prototype.page=function(a){if(typeof(a)!=="undefined"){this.pageCurrent=(Number(a)-1)}return this.next()};JDataPaging.prototype.next=function(){if(this.isServer){return JDataPaging.nextServer(this)}this.onNextBeforeCall([this]);++this.pageCurrent;this.back=false;this.clear();var e=JDataPaging.calculatesNext(this);var c=e.start,a=e.end;var d=this.rows.slice(c,a);for(var b in d){this.selectorBox.appendChild(d[b])}this.writeLabels().onNextAfterCall([d,this]).onCompleteCall([d]);return this};JDataPaging.previousServer=function(a){a.onPreviusBeforeCall([a]);if(a.pageCurrent>1){a.clear();--a.pageCurrent;JDataPaging.sendCallServer(a,"previous")}else{a.pageCurrent=1}return a};JDataPaging.calculatesPrevious=function(c){if(c.pageCurrent<1){c.pageCurrent=1}var a=0;if(c.pageCurrent>1){a=((c.limit*c.pageCurrent)-c.limit)<=c.rows.length?((c.limit*c.pageCurrent)-c.limit):((c.limit*(c.pageCurrent-1))-c.limit)}var b=(c.limit*c.pageCurrent);return{start:a,end:b}};JDataPaging.prototype.previous=function(){if(this.isServer){return JDataPaging.previousServer(this)}this.onPreviusBeforeCall([this]);this.clear();if(!this.back){--this.pageCurrent}this.back=false;var e=JDataPaging.calculatesPrevious(this);var c=e.start,a=e.end;var d=this.rows.slice(c,a);for(var b in d){this.selectorBox.appendChild(d[b])}this.writeLabels().onPreviousAfterCall([d,this]).onCompleteCall([d]);return this};JDataPaging.prototype.restart=function(a){var b=this;if(a){b.data=b.isArray(a)?{data:a}:a}b.pageCurrent=0;b.limit=b.pages[0];if(b.isAjax){b.rows=[];b.dataSupport.ajaxCallServer("start")}else{if(b.isServer){b.pageCurrent=1;return JDataPaging.sendCallServer(b,"restart")}else{if(b.jmsTemplate){return b.creaView().init().next().writeLabels()}else{return b.init().next().writeLabels()}}}};JDataPaging.prototype.clear=function(){var a=this;if(typeof(a.selectorBox)!=="undefined"&&typeof(a.selectorRowName)!=="undefined"){Array.prototype.forEach.call(a.selectorBox.querySelectorAll(a.selectorRowName),function(c,b){c.parentNode.removeChild(c)})}return this};JDataPaging.prototype.init=function(){var a=this;a.rows=[];a.rowsWrap=[];if(typeof(a.selectorBox)!=="undefined"&&typeof(a.selectorRowName)!=="undefined"){Array.prototype.forEach.call(a.selectorBox.querySelectorAll(a.selectorRowName),function(c,b){a.rows.push(c);a.rowsWrap.push(c);c.parentNode.removeChild(c)})}this.rowsTotal=a.rows.length;this.pageMax=Math.ceil((a.rows.length/a.limit));return this};JDataPaging.prototype.initPageServer=function(){var a=this;a.rows=[];a.rowsWrap=[];if(typeof(a.selectorBox)!=="undefined"&&typeof(a.selectorRowName)!=="undefined"){Array.prototype.forEach.call(a.selectorBox.querySelectorAll(a.selectorRowName),function(c,b){a.rows.push(c);a.rowsWrap.push(c);c.parentNode.removeChild(c)})}return this};JDataPaging.prototype.refreshLimit=function(e){if(e){this.limit=Number(e)}this.pageCurrent=1;this.back=false;this.clear();var c=0;var a=(this.limit*(this.pageCurrent));var d=this.rows.slice(c,a);for(var b in d){this.selectorBox.appendChild(d[b])}if(!this.isServer){this.rowsTotal=this.rows.length}this.pageMax=Math.ceil((this.rowsTotal/this.limit));if(e&&this.comboPages){Array.prototype.forEach.call(this.comboPages,function(g,f){g.value=e})}if(this.isServer){return JDataPaging.sendCallServer(this,"changeCombo")}this.writeLabels().onChangeComboPagesCall([{limit:this.limit,rowsTotal:this.rowsTotal,pageMax:this.pageMax},this]).onCompleteCall([d]);return this};JDataPaging.prototype.writeLabels=function(){var a=this;if(typeof(this.labelPageCurrent)!=="undefined"){Array.prototype.forEach.call(a.labelPageCurrent,function(c,b){c.innerHTML=a.back?(a.pageCurrent<a.pageMax)?(a.pageCurrent+1):a.pageCurrent:a.pageCurrent})}if(typeof(this.labelPageTotal)!=="undefined"){Array.prototype.forEach.call(a.labelPageTotal,function(c,b){c.innerHTML=a.pageMax})}return this};JDataPaging.prototype.initInputSearch=function(){var a=this;if(this.inputSearch){Array.prototype.forEach.call(this.inputSearch,function(c,b){c.addEventListener("keyup",function(){a.search(c.value)},false)})}return this};JDataPaging.prototype.initComboPages=function(){var a=this;if(this.comboPages){Array.prototype.forEach.call(this.comboPages,function(d,c){d.innerHTML="";for(var c in a.pages){var b=document.createElement("option");b.text=a.pages[c];d.add(b)}d.addEventListener("change",function(){a.refreshLimit(d.value)},false)})}return this};JDataPaging.prototype.initButtons=function(){var a=this;if(this.btnNext){Array.prototype.forEach.call(this.btnNext,function(c,b){c.addEventListener("click",function(){a.next()},false)})}if(this.btnPrevious){Array.prototype.forEach.call(this.btnPrevious,function(c,b){c.addEventListener("click",function(){a.previous()},false)})}return this};JDataPaging.prototype.search=function(b){var d=this;d.textSearch=String(b).toLowerCase();if(!d.isServer){d.rows=[];for(var c in d.rowsWrap){if(String(d.rowsWrap[c].innerText).toLowerCase().indexOf(d.textSearch)!==-1){d.rows.push(d.rowsWrap[c])}}d.clear();d.refreshLimit(d.limit)}if(this.isServer){d.pageCurrent=1;d.clear();return JDataPaging.sendCallServer(this,"changeCombo")}};JDataPaging.prototype.removeParameter=function(a){var b=this;if(typeof b.parameter[a]!=="undefined"){delete b.parameter[a]}};JDataPaging.prototype.addParameter=function(a,b){var c=this;c.parameter[a]=b};if(!("forEach" in Array.prototype)){Array.prototype.forEach=function(c,b){for(var a=0,d=this.length;a<d;a++){if(a in this){c.call(b,this[a],a,this)}}}}JDataPaging.paging=function(b,a){var d,c;if(typeof(arguments[0])==="object"){c=arguments[0]}else{if(typeof(arguments[0])==="string"){d=arguments[0]}}if(typeof(arguments[1])==="object"){c=arguments[1]}else{if(typeof(arguments[1])==="string"){d=arguments[1]}}if(typeof(d)==="undefined"){d=new Date().getTime()}if(typeof(JDataPaging.get[d])==="undefined"){JDataPaging.get[d]=new JDataPaging(c)}return JDataPaging.get[d]};