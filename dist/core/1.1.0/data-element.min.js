/*!
 * DataElementSupport v1.1.0
 * @author salvatore mariniello - salvo.mariniello@gmail.com 
 * https://github.com/mssalvo/DataElement/tree/master/dist/support
 *  GNU General Public License v3.0
 *  https://github.com/mssalvo/DataElement/blob/master/LICENSE
 * */
(function(){if(typeof window.console==="undefined"||typeof window.console.log==="undefined"){window.console={log:function(){}}}window.jQuery||console.log("DataElementSupport Info :: jQuery not istance! > check include jquery.js")})();function DataElementSupport(){}DataElementSupport.prototype.home=undefined;DataElementSupport.prototype.data={};DataElementSupport.prototype.ajax_={};DataElementSupport.prototype.current="index";DataElementSupport.prototype.space=" ";DataElementSupport.prototype.txtSpace=" ";DataElementSupport.prototype.divisor="@@";DataElementSupport.prototype.htmlTemplate={};DataElementSupport.prototype._=jQuery;DataElementSupport.expControll=new RegExp(/:\ *(\w+)\s*\@(:\1@|)/);DataElementSupport.expEvent=new RegExp(/^([a-z \ *]|:\1:)+/);DataElementSupport.expAction=new RegExp(/@\ *(\w+)\s*\/?(@.*\1.|)/);DataElementSupport.prototype.fn={};DataElementSupport.prototype.trim=function(b){return b.replace(/^\s+|\s+$/gm,"")};DataElementSupport.event=function(g,d,c,a){if(g.attachEvent){g.attachEvent("on"+d,c)}else{if(g.addEventListener){g.addEventListener(d,c,a)}else{g["on"+d]=c}}return this};DataElementSupport.bindPro=function(a,b){if(a.bind===Function.prototype.bind&&Function.prototype.bind){return Function.prototype.bind.apply(a,Array.prototype.slice.call(arguments,1))}var c=Array.prototype.slice.call(arguments,2);return function(){return a.apply(b,c.concat(Array.prototype.slice.call(arguments)))}};DataElementSupport.bind=function(i,h,g,c,b){var j=(new String(h)).split(" ");for(var d=0;d<j.length;d++){this.event(i,j[d],this.bindPro(g,c,b),true)}return this};DataElementSupport.prototype.isforEachIn=function(d,k,e){var l=[],f=this;Array.prototype.forEach.call(d.querySelectorAll("[for-foreach]"),function(n,m){l[n.getAttribute("for-foreach")]={attr:n.getAttribute("for-foreach"),exp:[],obj:n};n.removeAttribute("for-foreach");f.isforEachIn(n)});if(typeof(f.home.onBeforeRow)==="undefined"||typeof(f.home.onBeforeRow)!=="function"){f.home.onBeforeRow=function(n,m){return true}}var h=l;for(var b in h){for(var g in k[e][h[b]["attr"]]){var i=f._(h[b]["obj"]).clone().get(0);var a=f.array(i.getElementsByTagName("*"));if(f.home.onBeforeRow(i,k[e],e)){if(!a.length){h[b]["exp"]=[i]}else{h[b]["exp"]=a}for(var j in h[b]["exp"]){var c=h[b]["exp"][j];if(f.isAttributeForProp(c.attributes)){(function(n,m,o,p){f.updateObjectIn(n,m,o,p)})(h[b]["exp"][j],h[b]["attr"],k[e],g)}}f._(h[b]["obj"]).parent().append(i);f.initHtmlEvent(i)}}f._(h[b]["obj"]).remove()}return f};DataElementSupport.prototype.removeProperty=function(a,d){if(a&&a.attributes){var c=[];for(var b=0;b<a.attributes.length;b++){(function(g,f){if(f.attributes[g]&&d.test(f.attributes[g].name)){c.push(f.attributes[g].name)}})(b,a)}for(var e=0;e<c.length;e++){(function(g,f){f.removeAttribute(c[g])})(e,a)}}return this};DataElementSupport.prototype.propert=function(b){var a=b.split(".");if(a.length){return{key:a[0],val:a[1]}}else{return{key:a[0],val:a[0]}}};DataElementSupport.prototype.settingTag=function(a,b,c){switch(a){case"html":this._(b).html(c);break;case"after":this._(b).after(/^<(\w+)\s*\/?>(?:.* <\/\1>|)/.test(c?c:document.createTextNode(c)));break;case"before":this._(b).before(/^<(\w+)\s*\/?>(?:.* <\/\1>|)/.test(c)?c:document.createTextNode(c));break;case"append":this._(b).append(c);break;case"text":this._(b).text(c);break;default:if(this._(b).attr(a)){this._(b).attr(a,this._(b).attr(a)+c)}else{this._(b).attr(a,c)}}return this};DataElementSupport.prototype.settingTagOption=function(a,b,c){switch(a){case"html":this._(b).html(c);break;case"append":this._(b).html(c);break;case"text":this._(b).text(c);break;default:if(this._(b).attr(a)){this._(b).attr(a,this._(b).attr(a)+c)}else{this._(b).attr(a,c)}}return this};DataElementSupport.prototype.settingTagOption=function(a,b,c){switch(a){case"html":this._(b).html(c);break;case"append":this._(b).html(c);break;case"text":this._(b).text(c);break;default:if(this._(b).attr(a)){this._(b).attr(a,this._(b).attr(a)+c)}else{this._(b).attr(a,c)}}return this};DataElementSupport.prototype.isAttributeForProp=function(c){for(var b in c){if(c[b]&&/(for-property|for-property\-.*)+$/.test(c[b].name)){return 1}}return 0};DataElementSupport.prototype.getHtmlTemplate=function(a){return this.htmlTemplate[a]};DataElementSupport.prototype.setHtmlTemplate=function(b,a){this.htmlTemplate[b]=a};DataElementSupport.prototype.searchHtlmTemplate=function(a){var b=this;Array.prototype.forEach.call((a||document).querySelectorAll("[jms-template]"),function(d,c){b.setHtmlTemplate(d.getAttribute("jms-template"),d.innerHTML);b._(d).hide()});return b};DataElementSupport.prototype.updateObjectIn=function(c,e,a,d){if(c){for(var b=0;b<c.attributes.length;b++){(function(g,f,i){if(f.attributes[g]&&/(for-property|for-property\-.*)+$/.test(f.attributes[g].name)){var h=f.attributes[g].name.split("for-property-");var j=f.attributes[g].value.split(",");if(j){for(var k in j){if(f.nodeType===1){var l=j[k].split(".")[0];switch(l){case e:if(f.nodeName==="INPUT"){if(h[1]){this._(f).attr(h[1],typeof this.getObjVal(j,k,a,e,i)==="boolean"?this.getObjVal(j,k,a,e,i):this._(f).attr(h[1])+this.getObjVal(j,k,a,e,i))}else{f.value=this.getObjVal(j,k,a,e,i)}}else{if(f.nodeName==="OPTION"){if(h[1]){this.settingTagOption(h[1],f,this.getObjVal(j,k,a,e,i))}else{this._(f).html(this.getObjVal(j,k,a,e,i))}}else{if(h[1]){this.settingTag(h[1],f,this.getObjVal(j,k,a,e,i))}else{this._(f).append(this.getObjVal(j,k,a,e,i))}}}break;default:if(j[k].split(".").length<2){if(f.nodeName==="INPUT"){if(h[1]&&h[1]==="value"){f[h[1]]=a[j[k].split(".")[0]]}else{if(h[1]){this._(f).attr(h[1],this._(f).attr(h[1])+a[j[k].split(".")[0]])}else{f.value=a[j[k].split(".")[0]]}}}else{if(f.nodeName==="OPTION"){if(h[1]){this.settingTagOption(h[1],f,a[j[k].split(".")[0]])}else{this._(f).html(a[j[k].split(".")[0]])}}else{if(h[1]){this.settingTag(h[1],f,a[j[k].split(".")[0]])}else{this._(f).append(a[j[k].split(".")[0]])}}}}else{if(j[k].split(".").length>1){if(f.nodeName==="INPUT"){if(h[1]){this._(f).attr(h[1],this._(f).attr(h[1])+a[j[k].split(".")[0]][j[k].split(".")[1]])}else{f.value=a[j[k].split(".")[0]][j[k].split(".")[1]]}}else{if(f.nodeName==="OPTION"){if(h[1]){this.settingTagOption(h[1],f,a[j[k].split(".")[0]][j[k].split(".")[1]])}else{this._(f).html(a[j[k].split(".")[0]][j[k].split(".")[1]])}}else{if(h[1]){this.settingTag(h[1],f,a[j[k].split(".")[0]][j[k].split(".")[1]])}else{this._(f).append(a[j[k].split(".")[0]][j[k].split(".")[1]])}}}}}}}}}}})(b,c,d)}this.removeProperty(c,new RegExp(/(for-property|for-property\-.*)+$/))}return this};DataElementSupport.prototype.updateObject=function(b,f,c,d){var e=this;if(b){for(var a=0;a<b.attributes.length;a++){(function(h,g,j,l){if(g.attributes[h]&&/(for-property|for-property\-.*)+$/.test(g.attributes[h].name)){var i=g.attributes[h].name.split("for-property-");var k=g.attributes[h].value.split(",");if(k){for(var m in k){if(g.nodeType===1){var n=k[m].split(".")[0];switch(n){case f:if(g.nodeName==="INPUT"){if(i[1]){e._(g).attr(i[1],typeof e.getObjVal(k,m,l,f,j)==="boolean"?e.getObjVal(k,m,l,f,j):e._(g).attr(i[1])+e.getObjVal(k,m,l,f,j))}else{g.value=e.getObjVal(k,m,l,f,j)}}else{if(g.nodeName==="OPTION"){if(i[1]){e.settingTagOption(i[1],g,e.getObjVal(k,m,l,f,j))}else{e._(g).html(e.getObjVal(k,m,l,f,j))}}else{if(i[1]){e.settingTag(i[1],g,e.getObjVal(k,m,l,f,j))}else{e._(g).append(e.getObjVal(k,m,l,f,j))}}}break;default:if(k[m].split(".").length<2){if(g.nodeName==="INPUT"){if(i[1]&&i[1]==="value"){g[i[1]]=e.data[k[m].split(".")[0]]}else{if(i[1]){e._(g).attr(i[1],e._(g).attr(i[1])+l[k[m].split(".")[0]])}else{g.value=l[k[m].split(".")[0]]}}}else{if(g.nodeName==="OPTION"){if(i[1]){e.settingTagOption(i[1],g,l[k[m].split(".")[0]])}else{e._(g).html(l[k[m].split(".")[0]])}}else{if(i[1]){e.settingTag(i[1],g,l[k[m].split(".")[0]])}else{e._(g).append(l[k[m].split(".")[0]])}}}}else{if(k[m].split(".").length>1){if(g.nodeName==="INPUT"){if(i[1]){e._(g).attr(i[1],e._(g).attr(i[1])+l[k[m].split(".")[0]][k[m].split(".")[1]])}else{g.value=l[k[m].split(".")[0]][k[m].split(".")[1]]}}else{if(g.nodeName==="OPTION"){if(i[1]){e.settingTagOption(i[1],g,l[k[m].split(".")[0]][k[m].split(".")[1]])}else{e._(g).html(l[k[m].split(".")[0]][k[m].split(".")[1]])}}else{if(i[1]){e.settingTag(i[1],g,l[k[m].split(".")[0]][k[m].split(".")[1]])}else{if(!e.isUndefined(l[k[m].split(".")[0]])){e._(g).append(l[k[m].split(".")[0]][k[m].split(".")[1]])}}}}}}}}}}}})(a,b,c,d)}this.removeProperty(b,new RegExp(/(for-property|for-property\-.*)+$/))}};DataElementSupport.prototype.getValProp=function(f,e,h,a){var c=[];var g=this;var b=f.split(g.divisor);for(var d in b){if(b[d]===g.current){c.push(h)}if(b[d]===g.space){c.push(g.txtSpace)}if(b[d].indexOf(" ")!==-1&&b[d].length>2){c.push(b[d])}if(b[d].split(" ").join("")!==""&&a&&typeof e[b[d]]!=="undefined"){c.push(e[b[d]])}if(!a&&typeof e!=="undefined"){c.push(e)}}return c.join("")};DataElementSupport.prototype.getObjVal=function(h,g,d,c,j){var i=this,f=h[g].split(".");if(f.length<2){if(String(h[g]).indexOf(i.divisor)!==-1){return i.getValProp(h[g],d[c][j],j,false)}else{if(h[g]===i.current){return j}else{if(h[g]===i.space){return i.txtSpace}else{return d[c][j]}}}}else{if(String(f[1]).indexOf(i.divisor)!==-1){return i.getValProp(f[1],d[c][j],j,true)}if(f[1]===i.current){return j}if(f[1]===i.space){return i.txtSpace}if(d[c][j]){return d[c][j][f[1]]}return""}};DataElementSupport.prototype.isUndefined=function(a){return null===a?!0:a?"undefined"===typeof a:!0};DataElementSupport.prototype.isArrayNative=function(b){return !!b&&(typeof b==="object"||typeof b==="function")&&"length" in b&&!("setInterval" in b)&&(Object.prototype.toString.call(b)==="[object Array]"||"callee" in b||"item" in b)};DataElementSupport.prototype.array=function(d){if(!this.isArrayNative(d)){return[d]}if(d.item){var e=d.length,f=new Array(e);while(e--){f[e]=d[e]}return f}return Array.prototype.slice.call(d)};DataElementSupport.searchHtmlEvent=function(b){var a=[];Array.prototype.forEach.call(b.querySelectorAll("[jms-event]"),function(d,c){a[d.getAttribute("jms-event")+"-"+c]=d});return a};DataElementSupport.prototype.set=function(b,c){var a=b.split(".");switch(a.length){case 1:return this.data[a[0]];case 2:return this.data[a[0]][c][a[1]];case 3:return this.data[a[0]][c][a[1]][a[2]];case 4:return this.data[a[0]][c][a[1]][a[2]][a[3]];case 5:return this.data[a[0]][c][a[1]][a[2]][a[3]][a[4]];case 6:return this.data[a[0]][c][a[1]][a[2]][a[3]][a[4]][a[5]];case 7:return this.data[a[0]][c][a[1]][a[2]][a[3]][a[4]][a[5]][a[6]]}return this};DataElementSupport.prototype.isforEach=function(c){var g=[],f=this;if(typeof(f.home)==="undefined"){f.home={onBeforeRow:function(o,i){return true},onAfterRow:function(){}}}Array.prototype.forEach.call(c.querySelectorAll("[jms-foreach]"),function(q,o){g[q.getAttribute("jms-foreach")]={attr:q.getAttribute("jms-foreach"),exp:[],obj:q};q.removeAttribute("jms-foreach");f.isforEach(q)});if(typeof(f.home.onBeforeRow)==="undefined"||typeof(f.home.onBeforeRow)!=="function"){f.home.onBeforeRow=function(o,i){return true}}var d=g;for(var l in d){var a={},m=l.split(".").pop();a[m]=[];if(l.split(".").length>1){for(var p in f.data[l.split(".").shift()]){var e=f.set(l,p);a[m]=a[m].concat(e)}}else{a[m]=f.set(l,0)}console.log(a[m]);for(var n in a[m]){var j=f._(d[l]["obj"]).clone().get(0);var h=f.array(j.getElementsByTagName("*"));if(f.home.onBeforeRow(j,a[m][n],n)){if(!h.length){d[l]["exp"]=[j]}else{d[l]["exp"]=h}for(var k in d[l]["exp"]){var b=d[l]["exp"][k];if(f.isAttributeForProp(b.attributes)){(function(o,i,r,q){f.updateObject(o,i,r,q)})(d[l]["exp"][k],m,n,a)}}f._(d[l]["obj"]).parent().append(j);f.initHtmlEvent(j);f.isforEachIn(j,a[m],n);f.removeProperty(j,new RegExp(/(for-property|for-property\-.*)+$/));if(typeof(f.home.onAfterRow)!=="undefined"||typeof(f.home.onAfterRow)==="function"){f.home.onAfterRow(j,a[m][n],n)}}}f._(d[l]["obj"]).remove()}return f};DataElementSupport.prototype.createView=function(a,e,d){var c=this;c.searchHtlmTemplate(document).data=e;var b=c._(c.getHtmlTemplate(a)).get();c._(d).html(b);c.isforEach(d);c.initHtmlEvent(d);return this};DataElementSupport.prototype.initHtmlEvent=function(b){var h=this,a=h;var d=DataElementSupport.searchHtmlEvent(b);for(var f in d){var l=f.split("-")[0],m=h.trim(DataElementSupport.expEvent.exec(l)[0]),c=DataElementSupport.expControll.exec(l)[1],e=DataElementSupport.expAction.exec(l)[1],i=c.split(" ").join(""),e=e.split(" ").join(""),g=d[f],j=m.split(" ");g.removeAttribute("jms-event");for(var n in j){(function(p,o,k){DataElementSupport.bind(g,j[n],a[p][(function(q){return q})(o)],g,k)})(i,e,h.home)}}};DataElementSupport.prototype.ajaxCallServer=function(a){var b=this;b._.ajax({type:b.home.ajaxSetting.type||"get",url:b.home.ajaxSetting.url,data:b.home.parameter,dataType:b.home.ajaxSetting.dataType||"json"}).done(function(c,e,d){b.data=c;if(a&&a==="start"){b.home.start(c)}if(a&&a==="dataSet"){b.home.dataSet(c)}else{b.home.startServer(c,a)}}).fail(function(d,e,c){console.log(d.status);console.log(e);console.log(c)}).always(function(e,d,c){console.log("[request ajax: "+b.home.ajaxSetting.url+"] method: complete ",d)});return this};DataElementSupport.istance=function(){return new DataElementSupport()};