/*!
 * JDataPaging Â©
 * @version 1.1.1
 * @author salvatore mariniello - salvo.mariniello@gmail.com 
 * https://github.com/mssalvo/JDataPaging 
 * MIT License
 * Copyright (c) 2019 Salvatore Mariniello
 * https://github.com/mssalvo/JDataPaging/blob/master/LICENSE
 **/
function JDataPaging(t){window.console.log("INIT JDataPaging!"),t?this._new().settyng(t):window.console.log("JDataPaging Info: >> No object declared : Example [ JDataPaging.paging('myname',{data:object,box:' '}) ] info: https://github.com/mssalvo/JDataPaging")}JDataPaging.rows=[],JDataPaging.selectorBox={},JDataPaging.selectorRowName="",JDataPaging.limit=4,JDataPaging.pagination={},JDataPaging.pageCurrent=0,JDataPaging.pageMax=1,JDataPaging.labelPageCurrent=void 0,JDataPaging.labelPageTotal=void 0,JDataPaging.btnNext=void 0,JDataPaging.btnPrevious=void 0,JDataPaging.comboPages=void 0,JDataPaging.pages=["10","20","30","40","50"],JDataPaging.prototype.dataSupport=void 0,JDataPaging.get={},void 0!==window.console&&void 0!==window.console.log||(window.console={log:function(){}}),JDataPaging.prototype.log=function(t){},JDataPaging.prototype.isArray=function(t){return t.constructor.toString().indexOf("Array")>-1},JDataPaging.prototype.creaView=function(){return this.plugin?(this.clear(),this.dataSupport.home=this,this.dataSupport.produceView(this.jmsTemplate,this.data,this.selectorBox)):window.console.log("[JDataPaging] Info error:: dataSupport not istance > check include data-support.js"),this},JDataPaging.prototype.settyng=function(t){return this.pages=["10","20","30","50"],this.btnNext=void 0,this.btnPrevious=void 0,this.disableButton=void 0,this.ajaxSetting={url:"",type:"get",dataType:"json"},t.box&&(this.selectorBox=document.querySelector(t.box)||void 0),t.row&&(this.selectorRowName=t.row),this.rows=[],this.rowsWrap=[],this.pageCurrent=0,t.pages&&(this.pages=t.pages),t.btnNext&&(this.btnNext=document.querySelectorAll(t.btnNext)||void 0),t.btnPrevious&&(this.btnPrevious=document.querySelectorAll(t.btnPrevious)||void 0),t.comboPages&&(this.comboPages=document.querySelectorAll(t.comboPages)||void 0),t.labelPageCurrent&&(this.labelPageCurrent=document.querySelectorAll(t.labelPageCurrent)||void 0),t.labelPageTotal&&(this.labelPageTotal=document.querySelectorAll(t.labelPageTotal)||void 0),t.inputSearch&&(this.inputSearch=document.querySelectorAll(t.inputSearch)||void 0),this.limit=Number(this.pages[0]),t.messageEmpty&&(this.textMessageEmpty=t.messageEmpty),t.onComplete&&(this.onComplete=t.onComplete),t.onNextBefore&&(this.onNextBefore=t.onNextBefore),t.onNextAfter&&(this.onNextAfter=t.onNextAfter),t.onPreviusBefore&&(this.onPreviusBefore=t.onPreviusBefore),t.onPreviousAfter&&(this.onPreviousAfter=t.onPreviousAfter),t.onChangeComboPages&&(this.onChangeComboPages=t.onChangeComboPages),t.onBeforeRow&&(this.onBeforeRow=t.onBeforeRow),t.onAfterRow&&(this.onAfterRow=t.onAfterRow),void 0!==t.disableButton&&(this.disableButton=t.disableButton),t.backgroundDisable&&(this.backgroundDisable=t.backgroundDisable),t.backgroundEnabled&&(this.backgroundEnabled=t.backgroundEnabled),t.jmsTemplate&&(this.jmsTemplate=t.jmsTemplate),t.plugin&&(this.plugin=t.plugin),void 0!==t.autoStart&&(this.autoStart=t.autoStart),t.jmsTemplate&&(this.jmsTemplate=t.jmsTemplate),t.data&&(this.data=this.isArray(t.data)?{data:t.data}:t.data),t.plugin&&(this.dataSupport=this.plugin.istance(),this.dataSupport.home=this),t.plugin&&t.url&&(this.ajaxSetting.url=t.url),t.plugin&&t.param&&"function"==typeof t.param&&t.param.apply(this,[this.parameter]),t.plugin&&t.ajaxSetting&&"function"==typeof t.ajaxSetting&&t.ajaxSetting.apply(this,[this.ajaxSetting]),void 0!==t.isServer&&(this.isServer=t.isServer),void 0===this.ajaxSetting.type&&(this.ajaxSetting.type="get"),void 0===this.ajaxSetting.dataType&&(this.ajaxSetting.dataType="json"),void 0!==t.url&&(this.isAjax=!0),this.autoStart&&void 0!==t.url&&(this.isAjax=!0,this.dataSupport.ajaxCallServer("start")),this.autoStart&&void 0===t.url?this.start():(this.autoStart||void 0===t.url||this.dataSupport.ajaxCallServer("dataSet"),this)},JDataPaging.prototype.dataSet=function(t){return t&&(this.data=this.isArray(t)?{data:t}:t),this},JDataPaging.prototype.play=function(){return this.isAjax?(this.dataSupport.ajaxCallServer("start"),this):this.start()},JDataPaging.prototype.start=function(t){return this.pageCurrent=0,window.console.log("START JDataPaging!"),t&&(this.data=this.isArray(t)?{data:t}:t),this.jmsTemplate?this.creaView().init().initComboPages().initInputSearch().initButtons().next().writeLabels():this.init().initComboPages().initInputSearch().initButtons().next().writeLabels()},JDataPaging.prototype.getCurrentPage=function(){return this.pageCurrent},JDataPaging.prototype.getTotalPage=function(){return this.pageMax},JDataPaging.prototype._new=function(){return this.isServer=!1,this.isAjax=!1,this.ajaxSetting={url:"",type:"get",dataType:"json"},this.jmsTemplate=void 0,this.plugin={},this.data={},this.autoStart=!0,this.rows=[],this.rowsWrap=[],this.selectorBox=void 0,this.selectorRowName="",this.limit=10,this.rowsTotal=0,this.pagination=void 0,this.pageCurrent=0,this.pageMax=1,this.inputSearch=void 0,this.textSearch=void 0,this.labelPageCurrent=void 0,this.labelPageTotal=void 0,this.disableButton=void 0,this.backgroundDisable="#dddddd",this.backgroundEnabled="#ffb600",this.btnNext=void 0,this.btnPrevious=void 0,this.comboPages=void 0,this.onComplete=void 0,this.onNextBefore=void 0,this.onNextAfter=void 0,this.onPreviusBefore=void 0,this.onPreviousAfter=void 0,this.onChangeComboPages=void 0,this.textMessageEmpty='<div class="col text-center paging-empty">No records found</div>',this.onBeforeRow=function(t,e,a){return!0},this.onAfterRow=function(t,e,a){return!0},this.pages=["10","20","30","50"],this.back=!1,this},JDataPaging.prototype.onEmptyMessage=function(){return void 0===this.rowsWrap&&void 0!==this.selectorBox?(this.selectorBox.innerHTML=this.textMessageEmpty,this.disableButtons()):void 0!==this.rowsTotal&&this.rowsTotal<1&&void 0!==this.selectorBox?(this.selectorBox.innerHTML=this.textMessageEmpty,this.disableButtons()):this.enableButtons(),this},JDataPaging.prototype.setMessageEmpty=function(t){return void 0!==t&&(this.textMessageEmpty=t),this},JDataPaging.prototype.jmsEvent=function(t,e){return void 0!==this.dataSupport?void 0!==t&&"pp"!==t?this.dataSupport.fn[t]=e:window.console.log("INFO!! it is not possible to associate a function with the name (pp) - change function name! - the function [pp] could not be subscribed!! "):window.console.log("the function could not be subscribed, dataSupport and undefined! Add the JDataPagingSupport plugin. Example: JDataPaging.paging('myIstName', {plugin:JDataPagingSupport, .....})"),this},JDataPaging.prototype.jmsPipe=function(t,e){return void 0!==this.dataSupport?this.dataSupport.fn.pp[t]=e:window.console.log("the function could not be subscribed, dataSupport and undefined! Add the JDataPagingSupport plugin. Example: JDataPaging.paging('myIstName', {plugin:JDataPagingSupport, .....})"),this},JDataPaging.prototype.onCompleteCall=function(t){return this.onComplete&&"function"==typeof this.onComplete&&this.onComplete.apply(this,t),this},JDataPaging.prototype.onNextBeforeCall=function(t){return this.onNextBefore&&"function"==typeof this.onNextBefore&&this.onNextBefore.apply(this,t),this},JDataPaging.prototype.onNextAfterCall=function(t){return this.onNextAfter&&"function"==typeof this.onNextAfter&&this.onNextAfter.apply(this,t),this},JDataPaging.prototype.onPreviusBeforeCall=function(t){return this.onPreviusBefore&&"function"==typeof this.onPreviusBefore&&this.onPreviusBefore.apply(this,t),this},JDataPaging.prototype.onPreviousAfterCall=function(t){return this.onPreviousAfter&&"function"==typeof this.onPreviousAfter&&this.onPreviousAfter.apply(this,t),this},JDataPaging.prototype.onChangeComboPagesCall=function(t){return this.onChangeComboPages&&"function"==typeof this.onChangeComboPages&&this.onChangeComboPages.apply(this,t),this},JDataPaging.prototype.parameter={},JDataPaging.sendCallServer=function(t,e){var a=JDataPaging.calculatesSendStartEnd(t);return t.parameter.start=a.start,t.parameter.end=a.end,t.parameter.limit=t.limit,t.parameter.page=t.pageCurrent,t.parameter.totalrows=t.rowsTotal,t.textSearch&&(t.parameter.search=t.textSearch),void 0===t.textSearch&&void 0!==t.parameter.search&&delete t.parameter.search,""===t.textSearch&&void 0!==t.parameter.search&&delete t.parameter.search,t.parameter._tm=(new Date).getTime(),t.dataSupport.ajax_.parameters=t.parameter,t.dataSupport.ajax_.url=t.ajaxSetting.url,t.dataSupport.ajax_.type=t.ajaxSetting.type,t.dataSupport.ajax_.dataType=t.ajaxSetting.dataType,t.dataSupport.ajaxCallServer(e),t},JDataPaging.prototype.startServer=function(t,e){t&&(this.data=this.isArray(t)?{data:t,totalrows:t.length}:t),t.totalrows&&(this.rowsTotal=t.totalrows),this.pageMax=Math.ceil(this.rowsTotal/this.limit),this.jmsTemplate&&this.creaView().initPageServer();var a=this.rows.slice(0,this.limit);for(var i in a)this.selectorBox.appendChild(a[i]);return this.onEmptyMessage(),e&&"next"===e?this.writeLabels().onNextAfterCall([a,this]).onCompleteCall([a]):e&&"previous"===e?this.writeLabels().onPreviousAfterCall([a,this]).onCompleteCall([a]):e&&"changeCombo"===e?this.writeLabels().onChangeComboPagesCall([{limit:this.limit,rowsTotal:this.rowsTotal,pageMax:this.pageMax},this]).onCompleteCall([a]):this.writeLabels().onCompleteCall([a]),this},JDataPaging.nextServer=function(t){return t.onNextBeforeCall([t]),t.pageCurrent<1||t.pageCurrent>0&&t.rowsTotal>0&&t.pageCurrent*t.limit<t.rowsTotal?(++t.pageCurrent,t.clear(),JDataPaging.sendCallServer(t,"next")):t.pageCurrent=t.pageMax,t},JDataPaging.calculatesSendStartEnd=function(t){var e=0;1===t.pageCurrent&&(e=0),t.pageCurrent<1&&(t.pageCurrent=1,e=0),t.pageCurrent>1&&(e=(t.pageCurrent-1)*t.limit);var a=t.limit*t.pageCurrent;return a>t.rowsTotal&&t.rowsTotal>0&&(a=t.rowsTotal),{start:e,end:a}},JDataPaging.calculatesNext=function(t){var e=0;t.pageCurrent>1&&(e=t.limit*t.pageCurrent-t.limit<=t.rows.length?t.limit*t.pageCurrent-t.limit:t.limit*(t.pageCurrent-1)-t.limit);var a=t.limit*t.pageCurrent;return e+t.limit>=t.rows.length&&(--t.pageCurrent,t.back=!0),e>=t.rows.length&&(e=(e=t.rows.length-t.limit)<1?0:e),0===e&&(a=t.limit),{start:e,end:a}},JDataPaging.prototype.page=function(t){return void 0!==t&&(this.pageCurrent=Number(t)-1),this.next()},JDataPaging.prototype.next=function(){if(this.isServer)return JDataPaging.nextServer(this);this.onEmptyMessage(),this.onNextBeforeCall([this]),++this.pageCurrent,this.back=!1,this.disableButtonNext(),this.clear();var t=JDataPaging.calculatesNext(this),e=t.start,a=t.end,i=this.rows.slice(e,a);for(var r in i)this.selectorBox.appendChild(i[r]);return this.writeLabels().onNextAfterCall([i,this]).onCompleteCall([i]),this},JDataPaging.previousServer=function(t){return t.onPreviusBeforeCall([t]),t.pageCurrent>1?(t.clear(),--t.pageCurrent,JDataPaging.sendCallServer(t,"previous")):t.pageCurrent=1,t},JDataPaging.calculatesPrevious=function(t){t.pageCurrent<1&&(t.pageCurrent=1);var e=0;return t.pageCurrent>1&&(e=t.limit*t.pageCurrent-t.limit<=t.rows.length?t.limit*t.pageCurrent-t.limit:t.limit*(t.pageCurrent-1)-t.limit),{start:e,end:t.limit*t.pageCurrent}},JDataPaging.prototype.previous=function(){if(this.isServer)return JDataPaging.previousServer(this);this.onPreviusBeforeCall([this]),this.clear(),this.back||--this.pageCurrent,this.back=!1,this.disableButtonNext();var t=JDataPaging.calculatesPrevious(this),e=t.start,a=t.end,i=this.rows.slice(e,a);for(var r in i)this.selectorBox.appendChild(i[r]);return this.writeLabels().onPreviousAfterCall([i,this]).onCompleteCall([i]),this},JDataPaging.prototype.restart=function(t){if(t&&(this.data=this.isArray(t)?{data:t}:t),this.pageCurrent=0,this.limit=this.pages[0],!this.isAjax)return this.isServer?(this.pageCurrent=1,JDataPaging.sendCallServer(this,"restart")):this.jmsTemplate?this.creaView().init().next().writeLabels():this.init().next().writeLabels();this.rows=[],this.dataSupport.ajaxCallServer("start")},JDataPaging.prototype.clear=function(){return void 0!==this.selectorBox&&void 0!==this.selectorRowName&&"function"==typeof this.selectorBox.querySelectorAll&&Array.prototype.forEach.call(this.selectorBox.querySelectorAll(this.selectorRowName),function(t,e){t.parentNode.removeChild(t)}),this},JDataPaging.prototype.init=function(){var t=this;return t.rows=[],t.rowsWrap=[],void 0!==t.selectorBox&&void 0!==t.selectorRowName&&"function"==typeof t.selectorBox.querySelectorAll&&Array.prototype.forEach.call(t.selectorBox.querySelectorAll(t.selectorRowName),function(e,a){t.rows.push(e),t.rowsWrap.push(e),e.parentNode.removeChild(e)}),t.rowsTotal=t.rows.length,t.pageMax=Math.ceil(t.rows.length/t.limit),t},JDataPaging.prototype.initPageServer=function(){var t=this;return t.rows=[],t.rowsWrap=[],void 0!==t.selectorBox&&void 0!==t.selectorRowName&&"function"==typeof t.selectorBox.querySelectorAll&&Array.prototype.forEach.call(t.selectorBox.querySelectorAll(t.selectorRowName),function(e,a){t.rows.push(e),t.rowsWrap.push(e),e.parentNode.removeChild(e)}),t},JDataPaging.prototype.refreshLimit=function(t){t&&(this.limit=Number(t)),this.pageCurrent=1,this.back=!1,this.clear();var e=this.limit*this.pageCurrent,a=this.rows.slice(0,e);for(var i in a)this.selectorBox.appendChild(a[i]);return this.isServer||(this.rowsTotal=this.rows.length),this.pageMax=Math.ceil(this.rowsTotal/this.limit),t&&this.comboPages&&Array.prototype.forEach.call(this.comboPages,function(e,a){e.value=t}),this.isServer?JDataPaging.sendCallServer(this,"changeCombo"):(this.writeLabels().onChangeComboPagesCall([{limit:this.limit,rowsTotal:this.rowsTotal,pageMax:this.pageMax},this]).onCompleteCall([a]),this)},JDataPaging.prototype.writeLabels=function(){var t=this;return void 0!==t.labelPageCurrent&&Array.prototype.forEach.call(t.labelPageCurrent,function(e,a){e.innerHTML=t.back&&t.pageCurrent<t.pageMax?t.pageCurrent+1:t.pageCurrent}),void 0!==t.labelPageTotal&&Array.prototype.forEach.call(t.labelPageTotal,function(e,a){e.innerHTML=t.pageMax}),t.disableButtonPrevious(),t},JDataPaging.prototype.initInputSearch=function(){var t=this;return t.inputSearch&&Array.prototype.forEach.call(t.inputSearch,function(e,a){e.addEventListener("keyup",function(){t.search(e.value)},!1)}),t},JDataPaging.prototype.initComboPages=function(){var t=this;return t.comboPages&&Array.prototype.forEach.call(t.comboPages,function(e,a){for(var a in e.innerHTML="",t.pages){var i=document.createElement("option");i.text=t.pages[a],e.add(i)}e.addEventListener("change",function(){t.refreshLimit(e.value)},!1)}),t},JDataPaging.eventHandlers={},JDataPaging.addListener=function(t,e,a,i=!1){e in JDataPaging.eventHandlers||(JDataPaging.eventHandlers[e]=[]),JDataPaging.eventHandlers[e].push({node:t,handler:a,capture:i}),t.addEventListener(e,a,i)},JDataPaging.removeAllListeners=function(t,e){void 0!==JDataPaging.eventHandlers[e]&&(JDataPaging.eventHandlers[e].filter(({node:e})=>e===t).forEach(({node:t,handler:a,capture:i})=>t.removeEventListener(e,a,i)),JDataPaging.eventHandlers[e]=JDataPaging.eventHandlers[e].filter(({node:e})=>e!==t))},JDataPaging.prototype.initButtons=function(){var t=this;return t.btnNext&&Array.prototype.forEach.call(t.btnNext,function(e,a){JDataPaging.removeAllListeners(e,"click"),JDataPaging.addListener(e,"click",function(){t.next()},!1)}),t.btnPrevious&&Array.prototype.forEach.call(t.btnPrevious,function(e,a){JDataPaging.removeAllListeners(e,"click"),JDataPaging.addListener(e,"click",function(){t.previous()},!1)}),t},JDataPaging.prototype.disableButtonNext=function(){return this.disableButton&&!0===this.disableButton&&this.btnNext&&(this.pageCurrent===this.pageMax?Array.prototype.forEach.call(this.btnNext,function(t,e){t.style&&(t.style.pointerEvents="none"),t.style.backgroundColor="#ddd"}):Array.prototype.forEach.call(this.btnNext,function(t,e){t.style&&(t.style.pointerEvents="all"),t.style.backgroundColor="#ffb600"})),this},JDataPaging.prototype.disableButtonPrevious=function(){var t=this;return t.disableButton&&!0===t.disableButton&&t.btnPrevious&&(t.pageCurrent<=1?Array.prototype.forEach.call(t.btnPrevious,function(e,a){e.style&&(e.style.pointerEvents="none"),e.style.backgroundColor=t.backgroundDisable}):Array.prototype.forEach.call(t.btnPrevious,function(e,a){e.style&&(e.style.pointerEvents="all"),e.style.backgroundColor=t.backgroundEnabled})),t},JDataPaging.prototype.disableButtons=function(){return this.disableButton&&!0===this.disableButton&&(this.btnNext&&Array.prototype.forEach.call(this.btnNext,function(t,e){t.style&&(t.style.display="none")}),this.btnPrevious&&Array.prototype.forEach.call(this.btnPrevious,function(t,e){t.style&&(t.style.display="none")}),void 0!==this.labelPageCurrent&&Array.prototype.forEach.call(this.labelPageCurrent,function(t,e){t.style&&(t.style.display="none")}),void 0!==this.labelPageTotal&&Array.prototype.forEach.call(this.labelPageTotal,function(t,e){t.style&&(t.style.display="none")})),this},JDataPaging.prototype.enableButtons=function(){return this.btnNext&&Array.prototype.forEach.call(this.btnNext,function(t,e){t.style&&(t.style.display="block")}),this.btnPrevious&&Array.prototype.forEach.call(this.btnPrevious,function(t,e){t.style&&(t.style.display="block")}),void 0!==this.labelPageCurrent&&Array.prototype.forEach.call(this.labelPageCurrent,function(t,e){t.style&&(t.style.display="block")}),void 0!==this.labelPageTotal&&Array.prototype.forEach.call(this.labelPageTotal,function(t,e){t.style&&(t.style.display="block")}),this},JDataPaging.prototype.search=function(t){if(this.textSearch=String(t).toLowerCase(),!this.isServer){for(var e in this.rows=[],this.rowsWrap)-1!==String(this.rowsWrap[e].innerText).toLowerCase().indexOf(this.textSearch)&&this.rows.push(this.rowsWrap[e]);this.clear(),this.refreshLimit(this.limit)}return this.isServer?(this.pageCurrent=1,this.clear(),JDataPaging.sendCallServer(this,"changeCombo")):this},JDataPaging.prototype.removeParameter=function(t){return void 0!==this.parameter[t]&&delete this.parameter[t],this},JDataPaging.prototype.addParameter=function(t,e){return this.parameter[t]=e,this},"forEach"in Array.prototype||(Array.prototype.forEach=function(t,e){for(var a=0,i=this.length;a<i;a++)a in this&&t.call(e,this[a],a,this)}),JDataPaging.paging=function(t,e){var a,i;return"object"==typeof arguments[0]?i=arguments[0]:"string"==typeof arguments[0]&&(a=arguments[0]),"object"==typeof arguments[1]?i=arguments[1]:"string"==typeof arguments[1]&&(a=arguments[1]),void 0===a&&(a=(new Date).getTime()),void 0===JDataPaging.get[a]&&(JDataPaging.get[a]=new JDataPaging(i)),JDataPaging.get[a]};
