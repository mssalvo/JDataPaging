/*!
 * DataElementSupport v1.0.0
 * @author salvatore mariniello - salvo.mariniello@gmail.com 
 * https://github.com/mssalvo/DataElement/tree/master/dist/support
 * */
(function(){if(typeof window.console==="undefined"||typeof window.console.log==="undefined"){window.console={log:function(){}}}window.jQuery||console.log("DataElementSupport Info :: jQuery not istance! > check include jquery.js")})();function DataElementSupport(){}DataElementSupport.prototype.home=undefined;DataElementSupport.prototype.data={};DataElementSupport.prototype.ajax_={};DataElementSupport.prototype.current="index";DataElementSupport.prototype.htmlTemplate={};DataElementSupport.prototype._=jQuery;DataElementSupport.expControll=new RegExp(/:\ *(\w+)\s*\@(:\1@|)/);DataElementSupport.expEvent=new RegExp(/^([a-z \ *]|:\1:)+/);DataElementSupport.expAction=new RegExp(/@\ *(\w+)\s*\/?(@.*\1.|)/);DataElementSupport.prototype.fn={};DataElementSupport.prototype.trim=function(b){return b.replace(/^\s+|\s+$/gm,"")};DataElementSupport.event=function(g,d,c,a){if(g.attachEvent){g.attachEvent("on"+d,c)}else{if(g.addEventListener){g.addEventListener(d,c,a)}else{g["on"+d]=c}}return this};DataElementSupport.bindPro=function(a,b){if(a.bind===Function.prototype.bind&&Function.prototype.bind){return Function.prototype.bind.apply(a,Array.prototype.slice.call(arguments,1))}var c=Array.prototype.slice.call(arguments,2);return function(){return a.apply(b,c.concat(Array.prototype.slice.call(arguments)))}};DataElementSupport.bind=function(i,h,g,c,b){var j=(new String(h)).split(" ");for(var d=0;d<j.length;d++){this.event(i,j[d],this.bindPro(g,c,b),true)}return this};DataElementSupport.prototype.isforEachIn=function(d,k,e){var l=[],f=this;Array.prototype.forEach.call(d.querySelectorAll("[for-foreach]"),function(n,m){l[n.getAttribute("for-foreach")]={attr:n.getAttribute("for-foreach"),exp:[],obj:n};n.removeAttribute("for-foreach");f.isforEachIn(n)});var h=l;for(var b in h){for(var g in k[e][h[b]["attr"]]){var i=f._(h[b]["obj"]).clone().get(0);var a=f.array(i.getElementsByTagName("*"));if(!a.length){h[b]["exp"]=[i]}else{h[b]["exp"]=a}for(var j in h[b]["exp"]){var c=h[b]["exp"][j];if(f.isAttributeForProp(c.attributes)){(function(n,m,o,p){f.updateObjectIn(n,m,o,p)})(h[b]["exp"][j],h[b]["attr"],k[e],g)}}f._(h[b]["obj"]).parent().append(i);f.initHtmlEvent(i)}f._(h[b]["obj"]).remove()}return f};DataElementSupport.prototype.removeProperty=function(a,d){if(a&&a.attributes){var c=[];for(var b=0;b<a.attributes.length;b++){(function(g,f){if(f.attributes[g]&&d.test(f.attributes[g].name)){c.push(f.attributes[g].name)}})(b,a)}for(var e=0;e<c.length;e++){(function(g,f){f.removeAttribute(c[g])})(e,a)}}return this};DataElementSupport.prototype.propert=function(b){var a=b.split(".");if(a.length){return{key:a[0],val:a[1]}}else{return{key:a[0],val:a[0]}}};DataElementSupport.prototype.settingTag=function(a,b,c){switch(a){case"html":this._(b).html(c);break;case"after":this._(b).after(/^<(\w+)\s*\/?>(?:.* <\/\1>|)/.test(c?c:document.createTextNode(c)));break;case"before":this._(b).before(/^<(\w+)\s*\/?>(?:.* <\/\1>|)/.test(c)?c:document.createTextNode(c));break;case"append":this._(b).append(c);break;case"text":this._(b).text(c);break;default:if(this._(b).attr(a)){this._(b).attr(a,this._(b).attr(a)+c)}else{this._(b).attr(a,c)}}return this};DataElementSupport.prototype.settingTagOption=function(a,b,c){switch(a){case"html":this._(b).html(c);break;case"append":this._(b).html(c);break;case"text":this._(b).text(c);break;default:if(this._(b).attr(a)){this._(b).attr(a,this._(b).attr(a)+c)}else{this._(b).attr(a,c)}}return this};DataElementSupport.prototype.settingTagOption=function(a,b,c){switch(a){case"html":this._(b).html(c);break;case"append":this._(b).html(c);break;case"text":this._(b).text(c);break;default:if(this._(b).attr(a)){this._(b).attr(a,this._(b).attr(a)+c)}else{this._(b).attr(a,c)}}return this};DataElementSupport.prototype.isAttributeForProp=function(c){for(var b in c){if(c[b]&&/(for-property|for-property\-.*)+$/.test(c[b].name)){return 1}}return 0};DataElementSupport.prototype.getHtmlTemplate=function(a){return this.htmlTemplate[a]};DataElementSupport.prototype.setHtmlTemplate=function(b,a){this.htmlTemplate[b]=a};DataElementSupport.prototype.searchHtlmTemplate=function(a){var b=this;Array.prototype.forEach.call((a||document).querySelectorAll("[jms-template]"),function(d,c){b.setHtmlTemplate(d.getAttribute("jms-template"),d.innerHTML);b._(d).hide()});return b};DataElementSupport.prototype.updateObjectIn=function(c,e,a,d){if(c){for(var b=0;b<c.attributes.length;b++){(function(g,f,i){if(f.attributes[g]&&/(for-property|for-property\-.*)+$/.test(f.attributes[g].name)){var h=f.attributes[g].name.split("for-property-");var j=f.attributes[g].value.split(",");if(j){for(var k in j){if(f.nodeType==1){var l=j[k].split(".")[0];switch(l){case e:if(f.nodeName=="INPUT"){if(h[1]){this._(f).attr(h[1],this.getObjVal(j,k,a,e,i))}else{f.value=this.getObjVal(j,k,a,e,i)}}else{if(f.nodeName=="OPTION"){if(h[1]){this.settingTagOption(h[1],f,this.getObjVal(j,k,a,e,i))}else{this._(f).html(this.getObjVal(j,k,a,e,i))}}else{if(h[1]){this.settingTag(h[1],f,this.getObjVal(j,k,a,e,i))}else{this._(f).append(this.getObjVal(j,k,a,e,i))}}}break;default:if(j[k].split(".").length<2){if(f.nodeName=="INPUT"){if(h[1]&&h[1]=="value"){f[h[1]]=a[j[k].split(".")[0]]}else{if(h[1]){this._(f).attr(h[1],a[j[k].split(".")[0]])}else{f.value=a[j[k].split(".")[0]]}}}else{if(f.nodeName=="OPTION"){if(h[1]){this.settingTagOption(h[1],f,a[j[k].split(".")[0]])}else{this._(f).html(a[j[k].split(".")[0]])}}else{if(h[1]){this.settingTag(h[1],f,a[j[k].split(".")[0]])}else{this._(f).append(a[j[k].split(".")[0]])}}}}else{if(j[k].split(".").length>1){if(f.nodeName=="INPUT"){if(h[1]){this._(f).attr(h[1],a[j[k].split(".")[0]][j[k].split(".")[1]])}else{f.value=a[j[k].split(".")[0]][j[k].split(".")[1]]}}else{if(f.nodeName=="OPTION"){if(h[1]){this.settingTagOption(h[1],f,a[j[k].split(".")[0]][j[k].split(".")[1]])}else{this._(f).html(a[j[k].split(".")[0]][j[k].split(".")[1]])}}else{if(h[1]){this.settingTag(h[1],f,a[j[k].split(".")[0]][j[k].split(".")[1]])}else{this._(f).append(a[j[k].split(".")[0]][j[k].split(".")[1]])}}}}}}}}}}})(b,c,d)}this.removeProperty(c,new RegExp(/(for-property|for-property\-.*)+$/))}return this};DataElementSupport.prototype.updateObject=function(b,e,c){var d=this;if(b){for(var a=0;a<b.attributes.length;a++){(function(g,f,i){if(f.attributes[g]&&/(for-property|for-property\-.*)+$/.test(f.attributes[g].name)){var h=f.attributes[g].name.split("for-property-");var j=f.attributes[g].value.split(",");if(j){for(var k in j){if(f.nodeType==1){var l=j[k].split(".")[0];switch(l){case e:if(f.nodeName=="INPUT"){if(h[1]){d._(f).attr(h[1],d.getObjVal(j,k,d.data,e,i))}else{f.value=d.getObjVal(j,k,d.data,e,i)}}else{if(f.nodeName=="OPTION"){if(h[1]){d.settingTagOption(h[1],f,d.getObjVal(j,k,d.data,e,i))}else{d._(f).html(d.getObjVal(j,k,d.data,e,i))}}else{if(h[1]){d.settingTag(h[1],f,d.getObjVal(j,k,d.data,e,i))}else{d._(f).append(d.getObjVal(j,k,d.data,e,i))}}}break;default:if(j[k].split(".").length<2){if(f.nodeName=="INPUT"){if(h[1]&&h[1]=="value"){f[h[1]]=d.data[j[k].split(".")[0]]}else{if(h[1]){d._(f).attr(h[1],d.data[j[k].split(".")[0]])}else{f.value=d.data[j[k].split(".")[0]]}}}else{if(f.nodeName=="OPTION"){if(h[1]){d.settingTagOption(h[1],f,d.data[j[k].split(".")[0]])}else{d._(f).html(d.data[j[k].split(".")[0]])}}else{if(h[1]){d.settingTag(h[1],f,d.data[j[k].split(".")[0]])}else{d._(f).append(d.data[j[k].split(".")[0]])}}}}else{if(j[k].split(".").length>1){if(f.nodeName=="INPUT"){if(h[1]){d._(f).attr(h[1],d.data[j[k].split(".")[0]][j[k].split(".")[1]])}else{f.value=d.data[j[k].split(".")[0]][j[k].split(".")[1]]}}else{if(f.nodeName=="OPTION"){if(h[1]){d.settingTagOption(h[1],f,d.data[j[k].split(".")[0]][j[k].split(".")[1]])}else{d._(f).html(d.data[j[k].split(".")[0]][j[k].split(".")[1]])}}else{if(h[1]){d.settingTag(h[1],f,d.data[j[k].split(".")[0]][j[k].split(".")[1]])}else{if(!d.isUndefined(d.data[j[k].split(".")[0]])){d._(f).append(d.data[j[k].split(".")[0]][j[k].split(".")[1]])}}}}}}}}}}}})(a,b,c)}this.removeProperty(b,new RegExp(/(for-property|for-property\-.*)+$/))}};DataElementSupport.prototype.getObjVal=function(f,g,d,c,i){var h=this;if(f[g].split(".").length<2){if(f[g]==h.current){return i}return d[c][i]}else{if(f[g].split(".")[1]==h.current){return i}return d[c][i][f[g].split(".")[1]]}};DataElementSupport.prototype.isUndefined=function(a){return null==a?!0:a?"undefined"==typeof a:!0};DataElementSupport.prototype.isArrayNative=function(b){return !!b&&(typeof b=="object"||typeof b=="function")&&"length" in b&&!("setInterval" in b)&&(Object.prototype.toString.call(b)==="[object Array]"||"callee" in b||"item" in b)};DataElementSupport.prototype.array=function(d){if(!this.isArrayNative(d)){return[d]}if(d.item){var e=d.length,f=new Array(e);while(e--){f[e]=d[e]}return f}return Array.prototype.slice.call(d)};DataElementSupport.searchHtmlEvent=function(b){var a=[];Array.prototype.forEach.call(b.querySelectorAll("[jms-event]"),function(d,c){a[d.getAttribute("jms-event")+"-"+c]=d});return a};DataElementSupport.prototype.isforEach=function(b){var e=[],d=this;Array.prototype.forEach.call(b.querySelectorAll("[jms-foreach]"),function(l,k){e[l.getAttribute("jms-foreach")]={attr:l.getAttribute("jms-foreach"),exp:[],obj:l};l.removeAttribute("jms-foreach");d.isforEach(l)});var c=e;for(var i in c){for(var j in d.data[c[i]["attr"]]){var f=d._(c[i]["obj"]).clone().get(0);var g=d.array(f.getElementsByTagName("*"));if(!g.length){c[i]["exp"]=[f]}else{c[i]["exp"]=g}for(var h in c[i]["exp"]){var a=c[i]["exp"][h];if(d.isAttributeForProp(a.attributes)){(function(l,k,m){d.updateObject(l,k,m)})(c[i]["exp"][h],c[i]["attr"],j)}}d._(c[i]["obj"]).parent().append(f);d.initHtmlEvent(f);d.isforEachIn(f,d.data[c[i]["attr"]],j);d.removeProperty(f,new RegExp(/(for-property|for-property\-.*)+$/))}d._(c[i]["obj"]).remove()}return d};DataElementSupport.prototype.createView=function(a,e,d){var c=this;c.searchHtlmTemplate(document).data=e;var b=c._(c.getHtmlTemplate(a)).get();c._(d).html(b);c.isforEach(d);c.initHtmlEvent(d);return this};DataElementSupport.prototype.initHtmlEvent=function(b){var h=this,a=h;var d=DataElementSupport.searchHtmlEvent(b);for(var f in d){var l=f.split("-")[0],m=h.trim(DataElementSupport.expEvent.exec(l)[0]),c=DataElementSupport.expControll.exec(l)[1],e=DataElementSupport.expAction.exec(l)[1],i=c.split(" ").join(""),e=e.split(" ").join(""),g=d[f],j=m.split(" ");g.removeAttribute("jms-event");for(var n in j){(function(p,o,k){DataElementSupport.bind(g,j[n],a[p][(function(q){return q})(o)],g,k)})(i,e,h.home)}}};DataElementSupport.prototype.ajaxCallServer=function(a){var b=this;b._.ajax({type:b.home.ajaxSetting.type||"get",url:b.home.ajaxSetting.url,data:b.home.parameter,dataType:b.home.ajaxSetting.dataType||"json"}).done(function(c,e,d){b.data=c;if(a&&a==="start"){b.home.start(c)}else{b.home.startServer(c,a)}}).fail(function(d,e,c){console.log(d.status);console.log(e);console.log(c)}).always(function(e,d,c){console.log("[request ajax: "+b.home.ajaxSetting.url+"] method: complete ",d)});return this};DataElementSupport.istance=function(){return new DataElementSupport()};
